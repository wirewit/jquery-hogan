<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Mustache performance tester</title>
        <meta charset="utf-8"/>
        <script type="text/javascript" src="jquery-1.7.1.min.js">
        </script>

        <!--
        <script type="text/javascript" src="mustache.js">
        </script>
        -->
        <script type="text/javascript" src="hogan-1.0.5.min.js">
        </script>
        <script type="text/javascript" src="jquery.hogan.js">
        </script>


        <script type="text/javascript">
            var data = {
                username: "User name",
                email: "User email",
                info: "Detailed description",
                friends: [ "one", "two", "three"],
                accounts : {
                    vk : "vk.com/id00000",
                    fb : "fb.com/sample"
                },
                extension : function(){
                    return "Extended";
                }
            }

            jQuery(function(){
                // building templates
                jQuery("*[data-role=template]").each(function(){
                    var $n = jQuery(this);
                    $n.data(
                        "template", 
                        Hogan.compile(
                            $n.html().replace(/%7B%7B/g, '{{')
                                     .replace(/%7D%7D/g, '}}')
                        )
                    );
                });
                var repeats = 100;
                // first test
                var d1 = new Date();
                for (var r=0; r<repeats; r++){
                    var html = "<p>Here the sample content, generated by mustache</p>" +
                                "<dl><dt>Username</dt><dd>" + data.username + "</dd>" +
                                "<dt>email</dt><dd>" + data.email + "</dd>" +
                                "<dt>info</dt><dd>" + data.info + "</dd></dl>" + 
                                "<h3>friends</h3><ul>";
                    for (var i=0; i<data.friends.length; i++){
                        html += "<li>" + data.friends[i] + "</li>";
                    }
                    html += "</ul><h3>Accounts</h3><a href=\"" + data.accounts.vk + "\">VK</a>" +
                            "<a href=\"" + data.accounts.fb + "\">FB</a>" + "<p>" + 
                            data.extension() + "</p>";

                    jQuery("#plain-block").html(html);
                }
                var d2 = new Date();
                console.log(d2-d1, (d2-d1)/repeats);

                // mustache test
                /*
                d1 = new Date();
                for (var r=0; r<repeats; r++){
                    var $node = jQuery("#mustache-block");
                    var tmpl = $node.html().replace(/%7B%7B/g, '{{').replace(/%7D%7D/g, '}}');
                    $node.html(Mustache.to_html(tmpl, data));
                }
                d2 = new Date()
                console.log(d2-d1, (d2-d1)/repeats);
                */

                //hogan test
                d1 = new Date();
                for (var r=0; r<repeats; r++){
                    var $hn = jQuery("#hogan");
                    $hn.html($hn.data("template").render(data));
                }
                d2 = new Date();
                console.log(d2-d1, (d2-d1)/repeats);

                //plugin test
                d1 = new Date();
                for (var r=0; r<=repeats; r++){
                    jQuery("#hogan-plugin").hogan(data);
                };
                d2 = new Date();
                console.log(d2-d1, (d2-d1)/repeats);
            });
        </script>

    </head>
    <body>
        <div id="plain-block">
        </div>
        <div id="mustache-block">
            <p>Here the sample content, generated by mustache</p>
            <dl>
                <dt>Username</dt>
                <dd>{{username}}</dd>

                <dt>email</dt>
                <dd>{{email}}</dd>

                <dt>info</dt>
                <dd>{{info}}</dd>
            </dl>
            <h3>friends</h3>
            <ul>
                <!-- {{#friends}} -->
                <li>{{.}}</li>
                <!-- {{/friends}} -->
            </ul>
            <h3>Accounts</h3>
            <a href="{{accounts.vk}}">VK</a>
            <a href="{{accounts.fb}}">FB</a>
            <p>{{extension}}</p>
        </div>

        <div id="hogan" data-role="template">
            <p>Here the sample content, generated by mustache</p>
            <dl>
                <dt>Username</dt>
                <dd>{{username}}</dd>

                <dt>email</dt>
                <dd>{{email}}</dd>

                <dt>info</dt>
                <dd>{{info}}</dd>
            </dl>
            <h3>friends</h3>
            <ul>
                <!-- {{#friends}} -->
                <li>{{.}}</li>
                <!-- {{/friends}} -->
            </ul>
            <h3>Accounts</h3>
            <a href="{{accounts.vk}}">VK</a>
            <a href="{{accounts.fb}}">FB</a>
            <p>{{extension}}</p>
        </div>

        <div id="hogan-plugin">
            <p>Here the sample content, generated by mustache</p>
            <dl>
                <dt>Username</dt>
                <dd>{{username}}</dd>

                <dt>email</dt>
                <dd>{{email}}</dd>

                <dt>info</dt>
                <dd>{{info}}</dd>
            </dl>
            <h3>friends</h3>
            <ul>
                <!-- {{#friends}} -->
                <li>{{.}}</li>
                <!-- {{/friends}} -->
            </ul>
            <h3>Accounts</h3>
            <a href="{{accounts.vk}}">VK</a>
            <a href="{{accounts.fb}}">FB</a>
            <p>{{extension}}</p>
        </div>
    </body>
</html>

